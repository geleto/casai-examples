<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Generated Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
  </head>
  <body>
  <div class="container my-4">
    <!-- Header -->
    <div class="row mb-4">
      <div class="col-12">
        <h1 class="h4">Sales Analytics Dashboard</h1>
        <p class="text-muted mb-0">
          Chinook music store sample database containing customers, invoices, invoice line items, artists, albums, tracks, genres, and related reference tables.
        </p>
      </div>
    </div>

    <!-- KPI Row (third-width layout hint for two cards + spacer) -->
    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title mb-2">Total Revenue</h5>
            <p class="card-text text-muted small mb-2">A key performance indicator card displaying the overall total revenue across all sales.</p>
            <div class="d-flex align-items-center">
              <div id="kpi-total-revenue-value" class="fs-3 fw-semibold">$0.00</div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title mb-2">Total Customers</h5>
            <p class="card-text text-muted small mb-2">A key performance indicator card showing the total number of unique customers in the database.</p>
            <div class="d-flex align-items-center">
              <div id="kpi-total-customers-value" class="fs-3 fw-semibold">0</div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4"></div>
    </div>

    <!-- Row: Revenue by Genre & Revenue by Country -->
    <div class="row g-3 mb-4">
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title mb-2">Revenue by Genre</h5>
            <p class="card-text text-muted small mb-2">A bar chart displaying total revenue by music genre, sorted descending.</p>
            <div style="position: relative; height: 300px; width: 100%;">
              <canvas id="chart-revenue-genre"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title mb-2">Revenue by Country</h5>
            <p class="card-text text-muted small mb-2">A bar chart showing total revenue by billing country, sorted descending.</p>
            <div style="position: relative; height: 300px; width: 100%;">
              <canvas id="chart-revenue-country"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Row: Monthly Sales Trend (full-width) -->
    <div class="row g-3 mb-4">
      <div class="col-12">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title mb-2">Monthly Sales Trend</h5>
            <p class="card-text text-muted small mb-2">A line chart displaying total sales revenue by month over time.</p>
            <div style="position: relative; height: 300px; width: 100%;">
              <canvas id="chart-monthly-trend"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Row: Top Customers Table (full-width) -->
    <div class="row g-3 mb-4">
      <div class="col-12">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title mb-2">Top Customers by Total Spend</h5>
            <p class="card-text text-muted small mb-2">A data table listing the top 20 customers ranked by their total lifetime spending.</p>
            <div class="table-responsive">
              <table class="table table-striped table-sm" id="table-top-customers">
                <thead>
                  <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Total Spent</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Data populated by script -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Scripts to render charts and table using dataset previews via window.dashboardData -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Helper to fetch data via window.dashboardData using a known path
    const fetchData = (path) => {
      if (window && window.dashboardData && path in window.dashboardData) {
        const arr = window.dashboardData[path];
        return Array.isArray(arr) ? arr : [];
      }
      // Fallback: try to find by key
      if (window && window.dashboardData && typeof window.dashboardData === 'object') {
        for (const key in window.dashboardData) {
          if (key.endsWith(path)) {
            const arr = window.dashboardData[key];
            return Array.isArray(arr) ? arr : [];
          }
        }
      }
      return [];
    };

    // Map element IDs to their data file path
    const dataRepo = {
      'chart-revenue-genre': './data/chinook-point-4.json',
      'chart-revenue-country': './data/chinook-point-1.json',
      'chart-monthly-trend': './data/chinook-point-2.json',
      'table-top-customers': './data/chinook-point-3.json'
    };

    // Revenue by Genre Chart
    {
      const data = fetchData(dataRepo['chart-revenue-genre']);
      const labels = data.map(d => d.Name);
      const values = data.map(d => d.TotalRevenue);
      const ctx = document.getElementById('chart-revenue-genre').getContext('2d');
      if (ctx && labels.length) {
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              label: 'Revenue',
              data: values,
              backgroundColor: 'rgba(54, 162, 235, 0.7)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: { beginAtZero: true }
            },
            responsive: true,
            maintainAspectRatio: false
          }
        });
      }
    }

    // Revenue by Country Chart
    {
      const data = fetchData(dataRepo['chart-revenue-country']);
      const labels = data.map(d => d.BillingCountry);
      const values = data.map(d => d.TotalRevenue);
      const ctx = document.getElementById('chart-revenue-country').getContext('2d');
      if (ctx && labels.length) {
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              label: 'Revenue',
              data: values,
              backgroundColor: 'rgba(255, 159, 64, 0.7)',
              borderColor: 'rgba(255, 159, 64, 1)',
              borderWidth: 1
            }]
          },
          options: {
            indexAxis: 'y',
            scales: {
              x: { beginAtZero: true }
            },
            responsive: true,
            maintainAspectRatio: false
          }
        });
      }
    }

    // Monthly Sales Trend
    {
      const data = fetchData(dataRepo['chart-monthly-trend']);
      const normalized = data.map(d => ({
        key: `${d.Year}-${String(d.Month).padStart(2, '0')}`,
        display: `${d.Year}-${String(d.Month).padStart(2, '0')}`,
        val: d.MonthlySales
      }));
      const sorted = normalized.sort((a,b) => a.key.localeCompare(b.key));
      const labels = sorted.map(d => d.display);
      const values = sorted.map(d => d.val);
      const ctx = document.getElementById('chart-monthly-trend').getContext('2d');
      if (ctx && labels.length) {
        new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: [{
              label: 'Monthly Sales',
              data: values,
              fill: false,
              borderColor: 'rgba(75, 192, 192, 1)',
              tension: 0.1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: { beginAtZero: true }
            }
          }
        });
      }
    }

    // Top Customers Table
    {
      const data = fetchData(dataRepo['table-top-customers']);
      const tbody = document.querySelector('#table-top-customers tbody');
      if (tbody && Array.isArray(data)) {
        const sorted = data.slice().sort((a,b) => (Number(b.TotalSpent) || 0) - (Number(a.TotalSpent) || 0)).slice(0, 20);
        sorted.forEach(item => {
          const tr = document.createElement('tr');
          const tdFirst = document.createElement('td');
          tdFirst.textContent = item.FirstName || '';
          const tdLast = document.createElement('td');
          tdLast.textContent = item.LastName || '';
          const tdTotal = document.createElement('td');
          const spent = Number(item.TotalSpent) || 0;
          tdTotal.textContent = spent.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
          tr.appendChild(tdFirst);
          tr.appendChild(tdLast);
          tr.appendChild(tdTotal);
          tbody.appendChild(tr);
        });
      }
    }

    // KPI values are static placeholders since data source is not provided in this section
    const fmtMoney = (n) => {
      const v = Number(n) || 0;
      return v.toLocaleString(undefined, { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 });
    };
    const revenueElem = document.getElementById('kpi-total-revenue-value');
    const customersElem = document.getElementById('kpi-total-customers-value');
    if (revenueElem) revenueElem.textContent = fmtMoney(0);
    if (customersElem) customersElem.textContent = '0';
  });
  </script>
</body>
  <script>window.dashboardData = {"./data/chinook-point-1.json":[{"BillingCountry":"USA","TotalRevenue":523.06},{"BillingCountry":"Canada","TotalRevenue":303.96},{"BillingCountry":"France","TotalRevenue":195.1},{"BillingCountry":"Brazil","TotalRevenue":190.1},{"BillingCountry":"Germany","TotalRevenue":156.48},{"BillingCountry":"United Kingdom","TotalRevenue":112.86},{"BillingCountry":"Czech Republic","TotalRevenue":90.24},{"BillingCountry":"Portugal","TotalRevenue":77.24},{"BillingCountry":"India","TotalRevenue":75.26},{"BillingCountry":"Chile","TotalRevenue":46.62},{"BillingCountry":"Ireland","TotalRevenue":45.62},{"BillingCountry":"Hungary","TotalRevenue":45.62},{"BillingCountry":"Austria","TotalRevenue":42.62},{"BillingCountry":"Finland","TotalRevenue":41.62},{"BillingCountry":"Netherlands","TotalRevenue":40.62},{"BillingCountry":"Norway","TotalRevenue":39.62},{"BillingCountry":"Sweden","TotalRevenue":38.62},{"BillingCountry":"Spain","TotalRevenue":37.62},{"BillingCountry":"Poland","TotalRevenue":37.62},{"BillingCountry":"Italy","TotalRevenue":37.62},{"BillingCountry":"Denmark","TotalRevenue":37.62},{"BillingCountry":"Belgium","TotalRevenue":37.62},{"BillingCountry":"Australia","TotalRevenue":37.62},{"BillingCountry":"Argentina","TotalRevenue":37.62}],"./data/chinook-point-2.json":[{"Year":"2021","Month":"01","MonthlySales":35.64},{"Year":"2021","Month":"02","MonthlySales":37.62},{"Year":"2021","Month":"03","MonthlySales":37.62},{"Year":"2021","Month":"04","MonthlySales":37.62},{"Year":"2021","Month":"05","MonthlySales":37.62},{"Year":"2021","Month":"06","MonthlySales":37.62},{"Year":"2021","Month":"07","MonthlySales":37.62},{"Year":"2021","Month":"08","MonthlySales":37.62},{"Year":"2021","Month":"09","MonthlySales":37.62},{"Year":"2021","Month":"10","MonthlySales":37.62},{"Year":"2021","Month":"11","MonthlySales":37.62},{"Year":"2021","Month":"12","MonthlySales":37.62},{"Year":"2022","Month":"01","MonthlySales":52.62},{"Year":"2022","Month":"02","MonthlySales":46.62},{"Year":"2022","Month":"03","MonthlySales":44.62},{"Year":"2022","Month":"04","MonthlySales":37.62},{"Year":"2022","Month":"05","MonthlySales":37.62},{"Year":"2022","Month":"06","MonthlySales":37.62},{"Year":"2022","Month":"07","MonthlySales":37.62},{"Year":"2022","Month":"08","MonthlySales":37.62},{"Year":"2022","Month":"09","MonthlySales":36.63},{"Year":"2022","Month":"10","MonthlySales":37.62},{"Year":"2022","Month":"11","MonthlySales":37.62},{"Year":"2022","Month":"12","MonthlySales":37.62},{"Year":"2023","Month":"01","MonthlySales":37.62},{"Year":"2023","Month":"02","MonthlySales":37.62},{"Year":"2023","Month":"03","MonthlySales":37.62},{"Year":"2023","Month":"04","MonthlySales":51.62},{"Year":"2023","Month":"05","MonthlySales":42.62},{"Year":"2023","Month":"06","MonthlySales":50.62},{"Year":"2023","Month":"07","MonthlySales":37.62},{"Year":"2023","Month":"08","MonthlySales":37.62},{"Year":"2023","Month":"09","MonthlySales":37.62},{"Year":"2023","Month":"10","MonthlySales":37.62},{"Year":"2023","Month":"11","MonthlySales":23.76},{"Year":"2023","Month":"12","MonthlySales":37.62},{"Year":"2024","Month":"01","MonthlySales":37.62},{"Year":"2024","Month":"02","MonthlySales":37.62},{"Year":"2024","Month":"03","MonthlySales":37.62},{"Year":"2024","Month":"04","MonthlySales":37.62},{"Year":"2024","Month":"05","MonthlySales":37.62},{"Year":"2024","Month":"06","MonthlySales":37.62},{"Year":"2024","Month":"07","MonthlySales":39.62},{"Year":"2024","Month":"08","MonthlySales":47.62},{"Year":"2024","Month":"09","MonthlySales":46.71},{"Year":"2024","Month":"10","MonthlySales":42.62},{"Year":"2024","Month":"11","MonthlySales":37.62},{"Year":"2024","Month":"12","MonthlySales":37.62},{"Year":"2025","Month":"01","MonthlySales":37.62},{"Year":"2025","Month":"02","MonthlySales":27.72},{"Year":"2025","Month":"03","MonthlySales":37.62},{"Year":"2025","Month":"04","MonthlySales":33.66},{"Year":"2025","Month":"05","MonthlySales":37.62},{"Year":"2025","Month":"06","MonthlySales":37.62},{"Year":"2025","Month":"07","MonthlySales":37.62},{"Year":"2025","Month":"08","MonthlySales":37.62},{"Year":"2025","Month":"09","MonthlySales":37.62},{"Year":"2025","Month":"10","MonthlySales":37.62},{"Year":"2025","Month":"11","MonthlySales":49.62},{"Year":"2025","Month":"12","MonthlySales":38.62}],"./data/chinook-point-3.json":[{"FirstName":"Helena","LastName":"Holý","TotalSpent":49.62},{"FirstName":"Richard","LastName":"Cunningham","TotalSpent":47.62},{"FirstName":"Luis","LastName":"Rojas","TotalSpent":46.62},{"FirstName":"Ladislav","LastName":"Kovács","TotalSpent":45.62},{"FirstName":"Hugh","LastName":"O'Reilly","TotalSpent":45.62},{"FirstName":"Frank","LastName":"Ralston","TotalSpent":43.62},{"FirstName":"Julia","LastName":"Barnett","TotalSpent":43.62},{"FirstName":"Fynn","LastName":"Zimmermann","TotalSpent":43.62},{"FirstName":"Astrid","LastName":"Gruber","TotalSpent":42.62},{"FirstName":"Victor","LastName":"Stevens","TotalSpent":42.62},{"FirstName":"Terhi","LastName":"Hämäläinen","TotalSpent":41.62},{"FirstName":"František","LastName":"Wichterlová","TotalSpent":40.62},{"FirstName":"Isabelle","LastName":"Mercier","TotalSpent":40.62},{"FirstName":"Johannes","LastName":"Van der Berg","TotalSpent":40.62},{"FirstName":"Luís","LastName":"Gonçalves","TotalSpent":39.62},{"FirstName":"François","LastName":"Tremblay","TotalSpent":39.62},{"FirstName":"Bjørn","LastName":"Hansen","TotalSpent":39.62},{"FirstName":"Jack","LastName":"Smith","TotalSpent":39.62},{"FirstName":"Dan","LastName":"Miller","TotalSpent":39.62},{"FirstName":"Heather","LastName":"Leacock","TotalSpent":39.62}],"./data/chinook-point-4.json":[{"Name":"Rock","TotalRevenue":826.65},{"Name":"Latin","TotalRevenue":382.14},{"Name":"Metal","TotalRevenue":261.36},{"Name":"Alternative & Punk","TotalRevenue":241.56},{"Name":"TV Shows","TotalRevenue":93.53},{"Name":"Jazz","TotalRevenue":79.2},{"Name":"Blues","TotalRevenue":60.39},{"Name":"Drama","TotalRevenue":57.71},{"Name":"R&B/Soul","TotalRevenue":40.589999999999996},{"Name":"Classical","TotalRevenue":40.589999999999996},{"Name":"Sci Fi & Fantasy","TotalRevenue":39.8},{"Name":"Reggae","TotalRevenue":29.7},{"Name":"Pop","TotalRevenue":27.72},{"Name":"Soundtrack","TotalRevenue":19.8},{"Name":"Comedy","TotalRevenue":17.91},{"Name":"Hip Hop/Rap","TotalRevenue":16.83},{"Name":"Bossa Nova","TotalRevenue":14.85},{"Name":"Alternative","TotalRevenue":13.86},{"Name":"World","TotalRevenue":12.87},{"Name":"Science Fiction","TotalRevenue":11.94},{"Name":"Heavy Metal","TotalRevenue":11.879999999999999},{"Name":"Electronica/Dance","TotalRevenue":11.879999999999999},{"Name":"Easy Listening","TotalRevenue":9.9},{"Name":"Rock And Roll","TotalRevenue":5.9399999999999995}]};</script>
</html>
